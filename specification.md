# 가챠 게임 사양서 (Specification)

본 문서는 Rust로 구현된 핀볼 스타일의 가챠 게임에 대한 상세 사양서입니다. 이 문서는 게임의 물리 시스템, 환경, 객체, 그리고 로직을 정의합니다.

## 1. 시스템 개요
이 게임은 "공(Balls)"이 핀볼 형태의 보드 위에서 떨어지며 장애물과 상호작용하고, 최종적으로 바닥의 출구로 나가는 과정을 시뮬레이션하는 2D 물리 게임입니다. 공이 도착하는 순서(선착순 또는 후착순)에 따라 결과가 결정됩니다.

### 1.1 핵심 기술 스택
- **물리 엔진**: `Rapier2d` (Rust). RigidBodies(Dynamic, Static), Colliders(Ball, Cuboid, Triangle), Joints 등을 사용하여 물리 현상을 시뮬레이션합니다.
- **렌더링**: `egui` (Immediate Mode GUI)를 사용한 캔버스 렌더링.
- **플랫폼**: WebAssembly (WASM)로 컴파일되어 브라우저에서 실행.

## 2. 월드 및 환경
- **지도 크기**:
  - 논리적 너비: `500` 단위
  - 논리적 높이: `740` 단위
  - 좌표계: 중앙이 `(0, 0)`. Y축은 위쪽이 양수(Upward).
- **중력**: 물리 엔진 기본 중력 사용.
- **경계 (Boundaries)**:
  - **좌/우 벽**: 공이 옆으로 빠져나가는 것을 방지하는 정적(Static) 벽.
  - **상단 벽**: 공이 위로 튀어 나가는 것을 방지.
  - **바닥**: 공이 무한히 떨어지는 것을 방지하는 거대한 블록.

### 2.1 수직 구역 / 레이아웃 (Layout)
`(0,0)`을 중심으로 하는 좌표계 기준:
- **핀 그리드 구역**: 상단부. 공들이 처음 떨어져 흩어지는 핀들이 배치된 구역.
- **중간 장애물 구역**: 시소 및 풍차 등이 위치하여 변수를 창출하는 구역.
- **깔때기 (Funnel) 진입부**: `y = -170` 부근. 공들을 중앙으로 모으는 경사면.
- **슈트 (Chute)**: `y = -310` ~ `y = -350`. 공이 하나씩 통과하도록 하는 좁은 수직 통로.
- **도착 지점 (Threshold)**: `y = -360` 부근. 이 지점을 통과하면 "완주" 처리됨.

## 3. 게임 오브젝트

### 3.1 공 (Balls) - 플레이어
- **유형**: Dynamic RigidBody.
- **모양**: 원형 (Ball), 반지름 `8.0`.
- **물리 속성**:
  - 탄성 (Restitution): `0.7`
  - 마찰 (Friction): `0.0`
  - 밀도 (Density): `1.0`
  - 선형 감쇠 (Linear Damping): `0.1` (공기 저항).
  - CCD (연속 충돌 감지): 활성화됨 (터널링 방지).
- **시각 효과**:
  - 무작위 RGB 색상.
  - 이름 텍스트 라벨 표시.
  - 궤적 효과 (Trails) 및 충돌 시 파티클 생성.

### 3.2 정적 맵 요소 (Walls & Funnel)
- **재질**: Static. 탄성 `0.5`, 마찰 `0.0`.
- **구성**:
  - **깔때기 벽**: 공을 중앙 슈트로 유도하는 경사 벽.
  - **측면 범퍼**: 벽면에 부착되어 공을 튕겨내는 장애물.

### 3.3 핀 (Pins)
- **배치**: 격자(Grid) 형태로 배치된 정적 원형 장애물.
- **크기**: 반지름 `5.0`.
- **유형 및 확률**:
  - **일반 (Normal)**: 회색/흰색, 탄성 `0.7`.
  - **탄성 (Elastic)**: 색상별로 다른 탄성 계수를 가짐.
    - Blue (0.8), Green (1.0), Yellow (1.5), Orange (2.0), Red (3.0).

### 3.4 동적 장애물 (Dynamic Obstacles)

#### A. 풍차 (Windmills)
- **구조**:
  - **축 (Anchor)**: 고정된 정적 포인트.
  - **날개 (Blade)**: 회전하는 Cuboid.
- **물리**: 모터 조인트로 회전. 속도는 `Slow(1.0)`, `Normal(3.0)`, `Fast(5.0)` 중 하나.
- **시각 효과**: 회전 속도에 따라 색상 변경 (Cyan, Magenta, Purple). 중앙 기둥은 고정.

#### B. 시소 (Seesaws)
- **구조**: 중앙 피벗을 기준으로 자유 회전하는 판.
- **위치**: 맵 상단 좌우 및 중앙 하단에 배치되어 공의 흐름을 섞음.
- **물리**: 탄성 `0.2`, 마찰 `0.5`.

#### C. 이벤트 장애물 (Event Obstacles)
- **트리거**: 사용자 입력(버튼) 또는 랜덤 이벤트로 생성.
- **형태**: 원, 정사각형, 삼각형, 별 모양 등 무작위.
- **시각 효과**: 높은 채도의 네온 색상.
- **물리**: 맵 상단에서 생성되어 공들과 상호작용하며 떨어짐.

## 4. 게임 로직 및 UI

### 4.1 입력 및 시작
- **참가자 입력**: 텍스트 영역에 이름 입력.
  - `이름*숫자` 형식을 지원하여 여러 개의 공을 한 번에 생성 가능 (예: `참가자*5`).
- **게임 시작**: 파싱된 이름 수만큼 공을 상단에서 랜덤한 X 위치에 생성.

### 4.2 승리 조건 및 결과
- **도착 판정**: 공이 Y 좌표 임계값(Threshold) 아래로 떨어지면 "완주(Finished)"로 처리.
- **순위 결정**:
  - **먼저 들어온 순서 (First)**: 가장 먼저 도착한 공이 우승.
  - **늦게 들어온 순서 (Last)**: 가장 늦게 도착한 공이 우승 (옵션).
- **결과 창 (Results Window)**:
  - 완주한 공의 순위, 이름, 색상, 도착 시간을 리스트로 표시.

### 4.3 기타 기능
- **맵 초기화 (Reset)**: 'R' 키 또는 버튼으로 맵상의 모든 공과 이벤트 장애물을 제거하고 초기화.
- **창 크기**: 기본 `800 x 900`.
- **배포**: GitHub Actions를 통해 자동 빌드 및 배포.
